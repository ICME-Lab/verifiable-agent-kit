<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifiable Agent Kit - Browser Test</title>
    <style>
        body {
            font-family: monospace;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #00ff00;
            border-radius: 5px;
        }
        .status { margin: 10px 0; }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffff00; }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-family: monospace;
            margin: 5px;
        }
        button:hover { background: #00cc00; }
        .log {
            background: #000;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Verifiable Agent Kit - Browser Test Suite</h1>
    
    <div class="test-section">
        <h2>1Ô∏è‚É£ Wallet Connection Test</h2>
        <button onclick="testMetaMask()">Test MetaMask</button>
        <button onclick="testSolflare()">Test Solflare</button>
        <div id="wallet-status" class="status"></div>
    </div>

    <div class="test-section">
        <h2>2Ô∏è‚É£ Ethereum Verification Test</h2>
        <button onclick="testEthereumContract()">Check Contract</button>
        <button onclick="testEthereumVerification()">Test Verification</button>
        <div id="eth-status" class="status"></div>
        <div id="eth-log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>3Ô∏è‚É£ Solana Verification Test</h2>
        <button onclick="testSolanaConnection()">Check Connection</button>
        <button onclick="testSolanaProgram()">Test Program</button>
        <div id="sol-status" class="status"></div>
        <div id="sol-log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>4Ô∏è‚É£ System Configuration</h2>
        <button onclick="checkConfig()">Check Configuration</button>
        <div id="config-status" class="status"></div>
        <pre id="config-display"></pre>
    </div>

    <script>
        // Configuration
        const ETH_CONTRACT = '0x1e8150050a7a4715aad42b905c08df76883f396f';
        const SOL_PROGRAM = '5VzkNtgVwarEGSLvgvvPvTNqR7qQQai2MZ7BuYNqQPhw';
        
        function log(section, message, type = 'info') {
            const statusEl = document.getElementById(section + '-status');
            const logEl = document.getElementById(section + '-log');
            
            const className = type === 'success' ? 'success' : 
                            type === 'error' ? 'error' : 
                            type === 'warning' ? 'warning' : '';
            
            if (statusEl) {
                statusEl.innerHTML = `<div class="${className}">${message}</div>`;
            }
            
            if (logEl) {
                logEl.innerHTML += `<div class="${className}">[${new Date().toLocaleTimeString()}] ${message}</div>`;
                logEl.scrollTop = logEl.scrollHeight;
            }
        }

        // Test MetaMask
        async function testMetaMask() {
            log('wallet', 'Testing MetaMask connection...');
            
            if (typeof window.ethereum === 'undefined') {
                log('wallet', '‚ùå MetaMask not installed', 'error');
                return;
            }
            
            try {
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                if (accounts.length > 0) {
                    log('wallet', `‚úÖ MetaMask connected: ${accounts[0]}`, 'success');
                    
                    // Check network
                    const chainId = await window.ethereum.request({ 
                        method: 'eth_chainId' 
                    });
                    
                    if (chainId === '0xaa36a7') { // Sepolia
                        log('wallet', '‚úÖ Connected to Sepolia testnet', 'success');
                    } else {
                        log('wallet', `‚ö†Ô∏è Wrong network. Please switch to Sepolia (chainId: ${chainId})`, 'warning');
                    }
                }
            } catch (error) {
                log('wallet', `‚ùå MetaMask error: ${error.message}`, 'error');
            }
        }

        // Test Solflare
        async function testSolflare() {
            log('wallet', 'Testing Solflare connection...');
            
            if (!window.solflare) {
                log('wallet', '‚ùå Solflare not installed', 'error');
                return;
            }
            
            try {
                await window.solflare.connect();
                const publicKey = window.solflare.publicKey;
                
                if (publicKey) {
                    log('wallet', `‚úÖ Solflare connected: ${publicKey.toString()}`, 'success');
                }
            } catch (error) {
                log('wallet', `‚ùå Solflare error: ${error.message}`, 'error');
            }
        }

        // Test Ethereum Contract
        async function testEthereumContract() {
            log('eth', 'Checking Ethereum contract...');
            
            if (!window.ethereum) {
                log('eth', '‚ùå MetaMask not available', 'error');
                return;
            }
            
            try {
                // Request access if needed
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                // Check contract code
                const code = await window.ethereum.request({
                    method: 'eth_getCode',
                    params: [ETH_CONTRACT, 'latest']
                });
                
                if (code !== '0x') {
                    log('eth', `‚úÖ Contract deployed at ${ETH_CONTRACT}`, 'success');
                    log('eth', `Contract size: ${(code.length - 2) / 2} bytes`);
                    
                    // Check balance
                    const balance = await window.ethereum.request({
                        method: 'eth_getBalance',
                        params: [ETH_CONTRACT, 'latest']
                    });
                    
                    const ethBalance = parseInt(balance, 16) / 1e18;
                    log('eth', `Contract balance: ${ethBalance} ETH`);
                } else {
                    log('eth', '‚ùå No contract found at address', 'error');
                }
            } catch (error) {
                log('eth', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Test Ethereum Verification
        async function testEthereumVerification() {
            log('eth', 'Testing mock verification...');
            
            try {
                // This is a simulation since we need actual proof data
                const mockProofId = '0x' + Array(64).fill(0).map(() => 
                    Math.floor(Math.random() * 16).toString(16)
                ).join('');
                
                log('eth', `Generated mock proof ID: ${mockProofId.slice(0, 10)}...`);
                log('eth', '‚úÖ Verification system ready (mock test)', 'success');
                log('eth', 'To test real verification:');
                log('eth', '1. Generate a proof using the main UI');
                log('eth', '2. Click "Verify on-chain" for Ethereum');
                
            } catch (error) {
                log('eth', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Test Solana Connection
        async function testSolanaConnection() {
            log('sol', 'Testing Solana connection...');
            
            try {
                const response = await fetch('https://api.devnet.solana.com', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'getHealth'
                    })
                });
                
                const data = await response.json();
                
                if (data.result === 'ok') {
                    log('sol', '‚úÖ Connected to Solana Devnet', 'success');
                    
                    // Get slot
                    const slotResponse = await fetch('https://api.devnet.solana.com', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            jsonrpc: '2.0',
                            id: 1,
                            method: 'getSlot'
                        })
                    });
                    
                    const slotData = await slotResponse.json();
                    log('sol', `Current slot: ${slotData.result}`);
                } else {
                    log('sol', '‚ö†Ô∏è Solana network unhealthy', 'warning');
                }
            } catch (error) {
                log('sol', `‚ùå Connection error: ${error.message}`, 'error');
            }
        }

        // Test Solana Program
        async function testSolanaProgram() {
            log('sol', 'Checking Solana program...');
            
            try {
                const response = await fetch('https://api.devnet.solana.com', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'getAccountInfo',
                        params: [
                            SOL_PROGRAM,
                            { encoding: 'base64' }
                        ]
                    })
                });
                
                const data = await response.json();
                
                if (data.result && data.result.value) {
                    log('sol', `‚úÖ Program found at ${SOL_PROGRAM}`, 'success');
                    log('sol', `Owner: ${data.result.value.owner}`);
                    log('sol', `Size: ${data.result.value.data[0].length} bytes (base64)`);
                    log('sol', `Lamports: ${data.result.value.lamports}`);
                } else {
                    log('sol', '‚ùå Program not found at address', 'error');
                    log('sol', 'This program needs to be deployed for on-chain verification');
                }
            } catch (error) {
                log('sol', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Check Configuration
        async function checkConfig() {
            const config = {
                ethereum: {
                    contract: ETH_CONTRACT,
                    network: 'Sepolia Testnet',
                    explorer: `https://sepolia.etherscan.io/address/${ETH_CONTRACT}`
                },
                solana: {
                    program: SOL_PROGRAM,
                    network: 'Devnet',
                    explorer: `https://explorer.solana.com/address/${SOL_PROGRAM}?cluster=devnet`
                },
                wallets: {
                    ethereum: 'MetaMask',
                    solana: 'Solflare'
                },
                services: {
                    backend: 'http://localhost:8001',
                    websocket: 'ws://localhost:8001/ws',
                    python: 'http://localhost:8002'
                }
            };
            
            document.getElementById('config-display').textContent = JSON.stringify(config, null, 2);
            log('config', '‚úÖ Configuration loaded', 'success');
        }

        // Auto-run basic checks
        window.onload = () => {
            log('wallet', 'Ready to test wallet connections');
            log('eth', 'Ready to test Ethereum verification');
            log('sol', 'Ready to test Solana verification');
            checkConfig();
        };
    </script>
</body>
</html>